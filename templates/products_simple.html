{% extends "base_enhanced.html" %}

{% block title %}Products - {{ store_config.name }}{% endblock %}

{% block content %}
<!-- Breadcrumb -->
<section style="background: #f9fafb; padding: 1rem 0;">
    <div class="container">
        <nav style="font-size: 0.9rem; color: #6b7280;">
            <a href="{{ url_for('index') }}" style="color: #6b7280; text-decoration: none;">Home</a>
            <span> > </span>
            <span>Products</span>
        </nav>
    </div>
</section>

<!-- Products Header -->
<section style="padding: 2rem 0;">
    <div class="container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
            <h1 style="font-size: 2rem; color: #1f2937;">All Products</h1>
            
            <!-- Search and Filter -->
            <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
                <form method="GET" style="display: flex; gap: 0.5rem;">
                    <input type="text" name="search" value="{{ search_query or '' }}" placeholder="Search products..." 
                           style="padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.25rem; width: 200px;">
                    <button type="submit" style="background: #ff4747; color: white; padding: 0.5rem 1rem; border: none; border-radius: 0.25rem; cursor: pointer;">
                        Search
                    </button>
                </form>
                
                {% if categories %}
                <select onchange="window.location.href='{{ url_for('products') }}?category=' + this.value" 
                        style="padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.25rem;">
                    <option value="">All Categories</option>
                    {% for category in categories %}
                    <option value="{{ category.id }}" {% if current_category == category.id %}selected{% endif %}>
                        {{ category.name }}
                    </option>
                    {% endfor %}
                </select>
                {% endif %}
            </div>
        </div>

        <!-- Products Grid -->
        {% if products.items %}
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 2rem; margin-bottom: 3rem;">
            {% for product in products.items %}
            <div style="border: 1px solid #e5e7eb; border-radius: 0.5rem; overflow: hidden; transition: transform 0.2s; cursor: pointer;" 
                 onclick="window.location.href='{{ url_for('product_detail', slug=product.slug) }}'">
                <div style="height: 200px; background: #f3f4f6; display: flex; align-items: center; justify-content: center;">
                    {% if product.get_images() %}
                        <img src="{{ product.get_images()[0] }}" alt="{{ product.name }}" style="max-width: 100%; max-height: 100%; object-fit: cover;">
                    {% else %}
                        <span style="color: #9ca3af; font-size: 3rem;">ðŸ“¦</span>
                    {% endif %}
                </div>
                <div style="padding: 1rem;">
                    <h3 style="font-size: 1.1rem; margin-bottom: 0.5rem; color: #1f2937;">{{ product.name }}</h3>
                    <p style="color: #6b7280; font-size: 0.9rem; margin-bottom: 1rem;">{{ product.short_description or 'No description available' }}</p>
                    
                    <!-- Categories -->
                    {% if product.categories %}
                    <div style="margin-bottom: 0.5rem;">
                        {% for category in product.categories %}
                        <span style="background: #f3f4f6; color: #6b7280; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.8rem; margin-right: 0.25rem;">
                            {{ category.name }}
                        </span>
                        {% endfor %}
                    </div>
                    {% endif %}
                    
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div>
                            <span style="font-size: 1.2rem; font-weight: bold; color: #ff4747;">${{ "%.2f"|format(product.price) }}</span>
                            {% if product.compare_price and product.compare_price > product.price %}
                                <span style="text-decoration: line-through; color: #9ca3af; font-size: 0.9rem; margin-left: 0.5rem;">${{ "%.2f"|format(product.compare_price) }}</span>
                            {% endif %}
                        </div>
                        
                        {% if product.is_in_stock() %}
                            <span style="color: #10b981; font-size: 0.8rem;">In Stock</span>
                        {% else %}
                            <span style="color: #ef4444; font-size: 0.8rem;">Out of Stock</span>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Pagination -->
        {% if products.pages > 1 %}
        <div style="display: flex; justify-content: center; align-items: center; gap: 1rem;">
            {% if products.has_prev %}
                <a href="{{ url_for('products', page=products.prev_num, search=search_query, category=current_category) }}" 
                   style="padding: 0.5rem 1rem; background: #f3f4f6; border-radius: 0.25rem; text-decoration: none; color: #374151;">
                    Previous
                </a>
            {% endif %}
            
            <span style="color: #6b7280;">
                Page {{ products.page }} of {{ products.pages }}
            </span>
            
            {% if products.has_next %}
                <a href="{{ url_for('products', page=products.next_num, search=search_query, category=current_category) }}" 
                   style="padding: 0.5rem 1rem; background: #ff4747; color: white; border-radius: 0.25rem; text-decoration: none;">
                    Next
                </a>
            {% endif %}
        </div>
        {% endif %}
        
        {% else %}
        <div style="text-align: center; padding: 4rem 0;">
            <div style="font-size: 4rem; margin-bottom: 1rem;">ðŸ“¦</div>
            <h3 style="font-size: 1.5rem; color: #1f2937; margin-bottom: 1rem;">No Products Found</h3>
            <p style="color: #6b7280; margin-bottom: 2rem;">
                {% if search_query %}
                    No products found for "{{ search_query }}". Try a different search term.
                {% elif current_category %}
                    No products found in this category.
                {% else %}
                    No products available at the moment.
                {% endif %}
            </p>
            <a href="{{ url_for('products') }}" style="background: #ff4747; color: white; padding: 0.75rem 1.5rem; border-radius: 0.25rem; text-decoration: none;">
                View All Products
            </a>
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}